<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>FIRE & HAMMER</title>
    <!-- Favicon: Matched with iPhone Homepage Icon -->
    <link rel="icon" type="image/png" href="https://i.imgur.com/4g6nRcx.png">
    
    <!-- iPhone Homepage Icon (Apple Touch Icon) -->
    <link rel="apple-touch-icon" href="https://i.imgur.com/4g6nRcx.png">

    <!-- Apple-specific meta tags for iOS Home Screen App-like behavior (like Push*t) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FIRE & HAMMER">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Define custom colors using CSS variables for the new orange palette */
        :root {
            --primary-orange: #FF4F00; /* International Orange for primary buttons */
            --secondary-orange: #FF914D; /* Lighter shade for secondary buttons (now mostly for hover/background tints) */
            --dark-orange: #D94400; /* Darker shade for hover states of primary orange */
            --vcc-button-base: #A03000; /* Custom darker base for VCC Reading Plan button */
            --vcc-button-hover: #702000; /* Custom even darker hover for VCC Reading Plan button */
            --light-hover-orange-tint: rgba(255, 79, 0, 0.1); /* Very light orange tint for inactive mode button hover */
            --white: #FFFFFF; 
            --black: #323232; 
            --page-background-fallback: #323232; /* Dark fallback for campfire background */
            --card-background: rgba(36, 51, 80, 0.75); /* Consistent card background opacity */
            --mode-option-bg: rgba(36, 51, 80, 0.9); /* Slightly more opaque background for mode options */
        }

        /* Essential for full-page scrolling on mobile */
        html, body {
            height: 100%; /* Ensure html and body take full height */
            overflow-x: hidden; /* Prevent horizontal scrolling */
            overflow-y: auto; /* Enable vertical scrolling for the entire page */
        }

        /* Custom styles for Inter font and general body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--page-background-fallback); 
            background-image: url('https://images.unsplash.com/photo-1504470695779-75300268aa0e?q=80&w=2624&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'); 
            background-size: cover; 
            background-position: center; 
            background-repeat: no-repeat; 
            background-attachment: scroll; 
            
            display: block; /* Allow normal document flow for scrolling */
            margin: 0;
            padding: 0; /* Remove body padding, main card will handle spacing */
            text-align: center; /* Center elements within body */
        }
        
        /* Custom styles for the primary button-like links (action buttons) */
        .btn-link {
            background-color: var(--primary-orange); 
            color: var(--white); 
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; 
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.35); 
        }
        /* Darker orange on hover for the action buttons */
        .btn-link:hover {
            background-color: var(--dark-orange); 
            transform: translateY(-2px); 
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.45); 
        }
        .btn-link:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* Specific style for the VCC Reading Plan button */
        .btn-vcc-reading-plan {
            background-color: var(--vcc-button-base); /* Custom darker base color */
            color: var(--white); 
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; 
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.35); 
        }

        .btn-vcc-reading-plan:hover {
            background-color: var(--vcc-button-hover); /* Custom even darker on hover */
            transform: translateY(-2px); 
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.45); 
        }
        .btn-vcc-reading-plan:active {
            transform: translateY(0);
            box-shadow: none;
        }


        /* Title specific styling - now for the logo image only */
        .app-title {
            background-color: transparent; 
            box-shadow: none; 
            border-radius: 0; 
            padding: 0; 
            margin-bottom: 2rem; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            width: 100%; /* Ensure the container is full width */
        }

        .app-title img {
            width: 100%; 
            max-width: 300px; /* Constrain max width for better mobile display */
            height: auto; 
            object-fit: contain; 
            box-shadow: none; 
            border: none; 
        }
        
        /* Main card background with 75% opacity, but content remains opaque */
        .card-bg {
            background-color: var(--card-background); 
        }
        /* Text color inside the card, now WHITE for better contrast */
        .card-text {
            color: var(--white); 
        }

        /* Styling for the new mode selection button and options */
        .mode-selector-button {
            background-color: transparent; 
            color: var(--primary-orange); 
            border: 2px solid var(--primary-orange); 
            border-radius: 0.25rem; /* Reduced by half */
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.35); 
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; 
            width: 100%; 
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mode-selector-button:hover {
            background-color: var(--primary-orange); 
            color: var(--white); 
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.45);
        }
        .mode-selector-button:active {
            transform: translateY(0);
            box-shadow: none;
        }


        .mode-options-container {
            width: 100%; 
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            opacity: 0;
            margin-top: 0.75rem; 
            border-radius: 0.25rem; /* Reduced by half */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            background-color: var(--mode-option-bg); /* Added background color for dropdown */
            border: 1px solid rgba(255, 255, 255, 0.1); /* Added subtle border */
        }

        .mode-options-container.open {
            max-height: 300px; 
            opacity: 1;
            transition: max-height 0.5s ease-in, opacity 0.3s ease-in;
        }

        .mode-option {
            display: block;
            width: 100%;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); 
            color: var(--primary-orange); 
            background-color: transparent;
            border-left: 2px solid transparent; 
            border-right: 2px solid transparent; 
        }
        .mode-option:last-child {
            border-bottom: none; 
        }

        .mode-option:hover {
            background-color: var(--light-hover-orange-tint); 
        }

        .mode-option.active {
            background-color: var(--primary-orange); 
            color: var(--white);
            border-left-color: var(--primary-orange); 
            border-right-color: var(--primary-orange); 
        }

        /* Styles for transparent orange buttons (Back/Next in word-by-word mode) */
        .btn-transparent-orange {
            background-color: transparent;
            color: var(--primary-orange);
            border: 2px solid var(--primary-orange);
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: none; 
        }
        .btn-transparent-orange:hover {
            background-color: var(--primary-orange); 
            color: var(--white); 
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.25); 
        }
        .btn-transparent-orange:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* Styling for the feedback messages */
        #typing-feedback, #word-by-word-feedback {
            margin-top: 0.5rem; /* Reduced from 0.5rem to 0.25rem for more compactness */
            min-height: 1.5rem; 
            font-weight: bold; 
            color: var(--white); 
            display: block; /* Ensure it takes up space */
            text-align: center; /* Center the text within its container */
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
        }
        /* Specific style for the completion message */
        .completion-message {
            font-size: 1.5rem; /* Make it bigger */
            color: var(--primary-orange) !important; /* Make it orange, !important to override default color */
            text-shadow: 0 0 10px rgba(255, 79, 0, 0.8), 0 0 20px rgba(255, 79, 0, 0.6); /* Glow effect */
        }


        /* Style for revealed words in typing mode */
        .revealed-word {
            color: var(--primary-orange); 
            font-weight: bold;
        }

        /* Styles for scrollable verse content - now applied generally to dynamic-verse-display */
        .verse-scrollable-container { /* Renamed for clarity and general application */
            max-height: 34vh; /* Increased from 25vh by 35% */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; 
            padding-right: 0.5rem; 
            text-align: left; /* Keep verse text aligned left */
        }

        /* Confetti Canvas Styles */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            pointer-events: none; /* Allows clicks to pass through */
        }

        /* Hidden input for mobile keyboard triggering */
        .hidden-input {
            position: absolute;
            opacity: 0;
            pointer-events: none; /* Make it non-interactive to user clicks */
            width: 1px;
            height: 1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
        }

        /* Styling for the new custom text area */
        .custom-text-container textarea {
            background-color: rgba(36, 51, 80, 0.9);
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.25rem;
            padding: 0.75rem 1rem;
            width: 100%;
            min-height: 100px;
            margin-bottom: 0.75rem;
            font-size: 1rem;
            resize: vertical; /* Allow vertical resizing */
            text-align: left; /* Ensure textarea content is left aligned */
        }

        .custom-text-container textarea:focus {
            outline: none;
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 2px rgba(255, 79, 0, 0.5);
        }

        .custom-text-container label {
            display: block;
            text-align: left;
            color: var(--white);
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        /* Main content card adjustments to ensure it centers and allows body scrolling */
        .main-content-card {
            margin: 1rem auto; /* Add vertical margin to give space for scrolling */
        }

        /* --- Hamburger Menu Styles --- */
        #menu-toggle-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: transparent;
            border: none;
            cursor: pointer;
            z-index: 100; /* Ensure it's above other content */
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s ease;
        }
        #menu-toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        #menu-toggle-btn svg {
            width: 28px;
            height: 28px;
            color: var(--white); /* White color for the hamburger icon */
        }

        #side-menu {
            position: fixed;
            top: 0;
            right: -300px; /* Start off-screen to the right */
            width: 280px; /* Width of the menu */
            height: 100%;
            background-color: rgba(36, 51, 80, 0.95); /* Semi-transparent dark background */
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.4);
            transition: right 0.3s ease-in-out;
            z-index: 99; /* Below the toggle button */
            padding-top: 5rem; /* Space for the button at the top */
            display: flex;
            flex-direction: column;
        }

        #side-menu.open {
            right: 0; /* Slide in */
        }

        #side-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1; /* Allows list to take available space */
        }

        #side-menu ul li {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        #side-menu ul li:last-child {
            border-bottom: none;
        }

        #side-menu ul li a, #side-menu ul li button {
            display: block;
            width: 100%;
            padding: 1rem 1.5rem;
            color: var(--primary-orange);
            text-align: left;
            text-decoration: none;
            font-weight: 600;
            background-color: transparent;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        #side-menu ul li a:hover, #side-menu ul li button:hover {
            background-color: var(--light-hover-orange-tint);
            color: var(--white);
        }

        /* Overlay for when menu is open */
        #menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 98; /* Below menu, above content */
            display: none; /* Hidden by default */
        }

        /* Styling for the new footer in the side menu */
        .menu-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7); /* Lighter white for footer text */
            font-size: 0.85rem;
            text-align: center;
        }
    </style>
</head>
<body> 
    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas"></canvas>

    <!-- Hamburger Menu Toggle Button -->
    <button id="menu-toggle-btn" onclick="toggleMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
    </button>

    <!-- Side Menu -->
    <div id="side-menu">
        <ul>
            <li><button onclick="shareApp()">Tell a Friend</button></li>
            <li><button onclick="checkForUpdates()">Check for Updates</button></li>
            <li><a href="https://the-mount.netlify.app/" target="_blank" rel="noopener noreferrer">The Mount</a></li>
            <!-- You can add more menu items here -->
        </ul>
    </div>

    <!-- Overlay to close menu when clicking outside -->
    <div id="menu-overlay" onclick="toggleMenu()"></div>

    <!-- Main content container with 75% opacity background only -->
    <div class="mx-auto my-4 rounded-xl shadow-lg w-full card-bg max-w-full sm:max-w-2xl px-2 py-4 sm:p-8"> 
        <!-- Logo only in Title -->
        <h1 class="my-6 app-title">
            <img src="https://i.imgur.com/anFGJeG.png" alt="Fire & Hammer Logo">
        </h1>

        <div class="w-full card-bg px-2 py-4 sm:p-4 rounded-xl shadow-sm mb-8">
            <div id="dynamic-verse-display" class="flex flex-col items-start verse-scrollable-container"> 
                <a id="verse-reference-link" href="#" target="_blank" rel="noopener noreferrer" 
                   class="text-2xl mb-2 font-bold card-text w-full text-left no-underline hover:text-[var(--secondary-orange)] focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75">
                    </a>
                <p id="verse-content" class="text-xl card-text italic text-left w-full">
                    </p>
            </div>
            <div id="word-by-word-controls" class="mt-4 hidden">
                <div class="flex space-x-4">
                    <button id="prev-word-btn" class="btn-transparent-orange px-8 py-3 font-semibold flex-1 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap" onclick="showPreviousWord()">Back</button>
                    <button id="next-word-btn" class="btn-transparent-orange px-8 py-3 font-semibold flex-1 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap" onclick="showNextWord()">Next</button>
                </div>
                <!-- Feedback for word-by-word will appear here -->
                <p id="word-by-word-feedback" class="text-sm mt-2 card-text"></p>
            </div>
            <div id="typing-container" class="mt-4 hidden">
                <p id="typing-feedback" class="text-sm mt-2 card-text"></p> 
                <!-- Hidden input to trigger virtual keyboard on mobile -->
                <input type="text" id="hidden-typing-input" class="hidden-input" aria-hidden="true" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
            </div>
        </div>

        <div class="w-full card-bg px-2 py-4 sm:p-4 rounded-xl shadow-sm mb-8">
            <button id="mode-selector-button" class="mode-selector-button" onclick="toggleModeOptions()">
                <span id="current-mode-text">Full Passage</span>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 ml-2">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
            <div id="mode-options-container" class="mode-options-container">
                <button class="mode-option active" data-mode="full-passage" onclick="selectModeOption(this.dataset.mode)">Full Passage</button>
                <button class="mode-option" data-mode="first-letters" onclick="selectModeOption(this.dataset.mode)">First Letter</button>
                <button class="mode-option" data-mode="word-by-word" onclick="selectModeOption(this.dataset.mode)">Word By Word</button>
                <button class="mode-option" data-mode="type-first-letters" onclick="selectModeOption(this.dataset.mode)">Type First Letters</button>
            </div>
        </div>

        <div class="space-y-4"> 
            <!-- VCC Reading Plan restored -->
            <a href="https://valleycreek.plus/readingplan" target="_blank" rel="noopener noreferrer"
               class="btn-vcc-reading-plan block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap mb-4">
                VCC Reading Plan
            </a>

            <a href="#" data-verse-index="0" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                Psalm 1 NIV84
            </a>
            <a href="#" data-verse-index="1" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                Psalm 23 NIV84
            </a>

            <a href="#" data-verse-index="2" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                Psalm 103:1–13 NIV84
            </a>

            <a href="#" data-verse-index="3" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                John 15:1–17 NIV84
            </a>
            
            <a href="#" data-verse-index="4" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                Romans 8:37-39 NIV11
            </a>

            <a href="#" data-verse-index="5" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                1 Corinthians 13 NIV84
            </a>

            <a href="#" data-verse-index="6" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                Philippians 2:1–16 NIV11
            </a>

            <a href="#" data-verse-index="7" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                1 John 4:7–21 NIV11
            </a>
            <a href="#" data-verse-index="8" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                1 Thessalonians 5:16 NIV
            </a>
            <!-- Updated indices for remaining verses -->
            <a href="#" data-verse-index="9" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                John 3:16 NIV
            </a>
            <a href="#" data-verse-index="10" onclick="displaySpecificVerse(verses[this.dataset.verseIndex]); return false;"
               class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                Philippians 4:13 NIV
            </a>
        </div>

        <!-- New Blurb Section -->
        <div class="w-full card-bg px-2 py-4 sm:p-4 rounded-xl shadow-sm mt-8">
            <h3 class="text-xl font-bold card-text mb-2">Fire and Hammer</h3>
            <p class="text-lg card-text italic px-2 text-left mb-4">
                “Is not my word like fire,” declares the Lord, “and like a hammer that breaks a rock in pieces?”
                <a href="https://bible.com/bible/111/JER.23.29.NIV" target="_blank" rel="noopener noreferrer" class="text-[var(--primary-orange)] hover:text-[var(--secondary-orange)] no-underline">Jeremiah 23:29</a>
            </p>
            <p class="text-md card-text px-2 text-left">
                God’s Word isn’t just something we study. It’s something that forms us.
                <br>Like fire, it purifies. Like a hammer, it breaks through the lies we’ve believed.
                <br>Memorizing Scripture isn’t about religion–it’s about relationship.
                <br>Because when His Word lives in you, it starts to shape you from the inside out.
                <br>This isn’t about knowing more. It’s about becoming whole.
                <br>One verse at a time.
            </p>
        </div>

        <!-- New Custom Text Section -->
        <div class="w-full card-bg px-2 py-4 sm:p-4 rounded-xl shadow-sm mt-8 custom-text-container">
            <h3 class="text-xl font-bold card-text mb-4">Paste Your Own Text</h3>
            <label for="custom-text-input">Enter or paste your passage here:</label>
            <textarea id="custom-text-input" placeholder="e.g., 'For God so loved the world...'"></textarea>

            <button id="load-custom-text-btn" class="btn-link block w-full px-8 py-3 font-semibold rounded shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--primary-orange)] focus:ring-opacity-75 whitespace-nowrap">
                Load Custom Text
            </button>
            <p id="custom-text-feedback" class="text-sm mt-2 card-text"></p>
        </div>
    </div>

    <script>
        // Array containing the verses and their content, including YouVersion URLs and detailed metadata
        const verses = [
            {
                reference: "Psalm 1 NIV84",
                content: "Blessed is the man who does not walk in the counsel of the wicked or stand in the way of sinners or sit in the seat of mockers. But his delight is in the law of the Lord, and on his law he meditates day and night. He is like a tree planted by streams of water, which yields its fruit in season and whose leaf does not wither. Whatever he does prospers. Not so the wicked! They are like chaff that the wind blows away. Therefore the wicked will not stand in the judgment, nor sinners in the assembly of the righteous. For the Lord watches over the way of the righteous, but the way of the wicked will perish.",
                youversionUrl: "https://bible.com/bible/111/PSA.1.NIV"
            },
            {
                reference: "Psalm 23 NIV84",
                content: "The Lord is my shepherd, I shall not be in want. He makes me lie down in green pastures, he leads me beside quiet waters, he restores my soul. He guides me in paths of righteousness for his name’s sake. Even though I walk through the valley of the shadow of death, I will fear no evil, for you are with me; your rod and your staff, they comfort me. You prepare a table before me in the presence of my enemies. You anoint my head with oil; my cup overflows. Surely goodness and love will follow all the days of my life, and I will dwell in the house of the Lord forever.",
                youversionUrl: "https://bible.com/bible/111/PSA.23.NIV"
            },
            {
                reference: "Psalm 103:1–13 NIV84",
                content: `Praise the Lord, O my soul; all my inmost being, praise his holy name.
Praise the Lord, O my soul, and forget not all his benefits—
who forgives all your sins and heals all your diseases,
who redeems your life from the pit and crowns you with love and compassion,
who satisfies your desires with good things so that your youth is renewed like the eagle’s.
The Lord works righteousness and justice for all the oppressed.
He made known his ways to Moses, his deeds to the people of Israel:
The Lord is compassionate and gracious, slow to anger, abounding in love.
He will not always accuse, nor will he harbor his anger forever;
he does not treat us as our sins deserve or repay us according to our iniquities.
For as high as the heavens are above the earth, so great is his love for those who fear him;
as far as the east is from the west, so far has he removed our transgressions from us.
As a father has compassion on his children, so the Lord has compassion on those who fear him.`,
                youversionUrl: "https://bible.com/bible/111/PSA.103.1-13.NIV"
            },
            {
                reference: "John 15:1–17 NIV84",
                content: "“I am the true vine, and my Father is the gardener. He cuts off every branch in me that bears no fruit, while every branch that does bear fruit he prunes so that it will be even more fruitful. You are already clean because of the word I have spoken to you. Remain in me, as I also will remain in you. No branch can bear fruit by itself; it must remain in the vine. Neither can you bear fruit unless you remain in me. “I am the vine; you are the branches. If a man remains in me and I in him, he will bear much fruit; apart from me can do nothing. If anyone does not remain in me, he is like a branch that is thrown away and withers; such branches are picked up, thrown into the fire and burned. If you remain in me and my words remain in you, ask whatever you wish, and it will be given you. This is to my Father’s glory, that you bear much fruit, showing yourselves to be my disciples. “As the Father has loved me, so have I loved you. Now remain in my love. If you obey my commands, you will remain in my love, just as I have obeyed My Father’s commands and remain in his love. I have told you this so that my joy may be in you and that your joy may be complete. My command is this: Love each other. Greater love has no one than this, that he lay down his life for his friends. You are my friends if you do what I command. I no longer call servants, because a servant does not know his master’s business. Instead, I have called you friends, for everything that I learned from My Father I have made known to you. You did not choose me, but I chose you and appointed you to go and bear fruit—fruit that will last. Then the Father will give you whatever you ask in My name. This is my command: Love each other.",
                youversionUrl: "https://bible.com/bible/111/JHN.15.1-17.NIV"
            },
            {
                reference: "Romans 8:37-39 NIV11",
                content: "No, in all these things we are more than conquerors through him who loved us. For I am convinced that neither death nor life, neither angels nor demons, neither the present nor the future, nor any powers, neither height nor depth, nor anything else in all creation, will be able to separate us from the love of God that is in Christ Jesus our Lord.",
                youversionUrl: "https://bible.com/bible/111/ROM.8.37-39.NIV"
            },
            {
                reference: "1 Corinthians 13 NIV84",
                content: "If I speak in the tongues of men and of angels, but have not love, I am only a resounding gong or a clanging cymbal. If I have the gift of prophecy and can fathom all mysteries and all knowledge, and if I have a faith that can move mountains, but have not love, I am nothing. If I give all I possess to the poor and surrender my body to the flames, but have not love, I gain nothing. Love is patient, love is kind. It does not envy, it does not boast, it is not proud. It is not rude, it is not self-seeking, it is not easily angered, it keeps no record of wrongs. Love does not delight in evil but rejoices with the truth. It always protects, always trusts, always hopes, always perseveres. Love never fails. But where there are prophecies, they will cease; where there are tongues, they will be stilled; where there is knowledge, it will pass away. For we know in part and we prophesy in part, but when perfection comes, the imperfect disappears. When I was a child, I talked like a child, I thought like a child, I reasoned like a child. When I became a man, I put childish ways behind me. Now we see but a poor reflection as in a mirror; then we shall see face to face. Now I know in part; then I shall know fully, even as I am fully known. And now these three remain: faith, hope and love. But the greatest of these is love.",
                youversionUrl: "https://bible.com/bible/111/1CO.13.NIV"
            },
            {
                reference: "Philippians 2:1–16 NIV11",
                content: "Therefore if you have any encouragement from being united with Christ, if any comfort from his love, if any common sharing in the Spirit, if any tenderness and compassion, then make my joy complete by being like-minded, having the same love, being one in spirit and of one mind. Do nothing out of selfish ambition or vain conceit, but in humility consider others better than yourselves. Each of you should look not only to your own interests, but also to the interests of others. Your attitude should be the same as that of Christ Jesus: Who, being in very nature God, did not consider equality with God something to be grasped, but made himself nothing, taking the very nature of a servant, being made in human likeness. And being found in appearance as a man, he humbled himself and became obedient to death—even death on a cross! Therefore God exalted him to the highest place and gave him the name that is above every name, that at the name of Jesus every knee should bow, in heaven on earth and under the earth, and every tongue confess that Jesus Christ is Lord, to the glory of God the Father. Therefore, my dear friends, as you have always obeyed—not only in my presence, but now much more in my absence—continue to work out your salvation with fear and trembling, for it is God who works in you to will and to act according to his good purpose. Do everything without grumbling or arguing, so that you may become blameless and pure, children of God without fault in a crooked and depraved generation, in which you shine like stars in the universe as you hold out the word of life—in order to that I may boast on the day of Christ that I did not run or labor for nothing.",
                youversionUrl: "https://bible.com/bible/111/PHP.2.1-16.NIV"
            },
            {
                reference: "1 John 4:7–21 NIV11",
                content: "Dear friends, let us love one another, for love comes from God. Everyone who loves has been born of God and knows God. Whoever does not love does not know God, because God is love. This is how God showed his love among us: He-sent his one and only Son into the world that we might live through him. This is love: not that we loved God, but that he loved us and sent his Son as an atoning sacrifice for our sins. Dear friends, since God so loved us, we also ought to love one another. No one has ever seen God; but if we love one another, God lives in us and his love is made complete in us. This is how we know that we live in him and he in us: He has given us of his Spirit. And we have seen and testify that the Father has sent his Son to be the Savior of the world. If anyone acknowledges that Jesus is the Son of God, God lives in them and they in God. And so we know and rely on the love God has for us. God is love. Whoever lives in love lives in God, and God in them. This is how love is made complete among us so that we will have confidence on the Day of Judgment: In this world we are like Jesus. There is no fear in love. But perfect love drives out fear, because fear has to do with punishment. The one who fears is not made perfect in love. We love because he first loved us. Whoever claims to love God yet hates a brother or sister is a liar. For whoever does not love their brother or sister, whom they have seen, cannot love God, whom they have not seen. And he has given us this command: Anyone who loves God must also love their brother and sister.",
                youversionUrl: "https://bible.com/bible/111/1JN.4.7-21.NIV"
            },
            {
                reference: "1 Thessalonians 5:16 NIV",
                content: "Rejoice always",
                youversionUrl: "https://bible.com/bible/111/1TH.5.16.NIV"
            },
            {
                reference: "John 3:16 NIV",
                content: "For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.",
                youversionUrl: "https://bible.com/bible/111/JHN.3.16.NIV"
            },
            {
                reference: "Philippians 4:13 NIV",
                content: "I can do all this through him who gives me strength.",
                youversionUrl: "https://bible.com/bible/111/PHP.4.13.NIV"
            }
        ];

        const verseReferenceElement = document.getElementById('verse-reference-link'); 
        const verseContentElement = document.getElementById('verse-content');
        const wordByWordControls = document.getElementById('word-by-word-controls');
        const nextWordBtn = document.getElementById('next-word-btn');
        const prevWordBtn = document.getElementById('prev-word-btn'); 
        
        const modeSelectorButton = document.getElementById('mode-selector-button');
        const currentModeText = document.getElementById('current-mode-text');
        const modeOptionsContainer = document.getElementById('mode-options-container');
        const modeOptions = document.querySelectorAll('.mode-option');

        // Elements for typing mode
        const typingContainer = document.getElementById('typing-container');
        const typingFeedback = document.getElementById('typing-feedback'); 
        const wordByWordFeedback = document.getElementById('word-by-word-feedback'); 
        
        const dynamicVerseDisplayContainer = document.getElementById('dynamic-verse-display'); 
        const hiddenTypingInput = document.getElementById('hidden-typing-input'); 

        // Custom Text Elements
        const customTextInput = document.getElementById('custom-text-input');
        const loadCustomTextBtn = document.getElementById('load-custom-text-btn');
        const customTextFeedback = document.getElementById('custom-text-feedback');

        // Confetti Canvas elements
        const confettiCanvas = document.getElementById('confetti-canvas');
        const confettiCtx = confettiCanvas.getContext('2d');
        let confettiParticles = [];
        let animationFrameId = null; 

        // Menu elements
        const sideMenu = document.getElementById('side-menu');
        const menuOverlay = document.getElementById('menu-overlay');

        // Version number element
        const versionNumberDisplay = document.getElementById('version-number-display');

        // New global variable to hold the currently displayed verse object
        let currentActiveVerse = null; 

        let currentDisplayMode = 'full-passage'; 
        let currentWordsArray = []; 
        let currentWordIndexForProgressiveReveal = 0; 

        let typingVerseWords = []; 
        let typingWordIndex = 0; 

        let currentFeedbackTimeout; // To manage message fade-out

        // --- Creative Feedback Messages ---
        const correctMessages = [
            "Got it!", "Nice!", "Spot on!", "Yes!", "Right on!", 
            "Perfect!", "Keep it going!", "That's it!", "On fire!"
        ];

        const incorrectMessages = [
            "Hmm, not quite.", "Close, but not it.", "Try another letter.", 
            "Give it another shot!", "Almost there, focus!", "Not that one.", 
            "Think it through!"
        ];

        // Updated completion message
        const completionMessages = [
            "You're carrying the fire!"
        ];

        /**
         * Get a random message from an array.
         * @param {Array<string>} messagesArray The array of messages.
         * @returns {string} A randomly selected message.
         */
        function getRandomMessage(messagesArray) {
            const randomIndex = Math.floor(Math.random() * messagesArray.length);
            return messagesArray[randomIndex];
        }

        /**
         * Displays a feedback message in the specified element, applying styles and managing fade-out.
         * @param {HTMLElement} element The HTML element to display the message in (e.g., typingFeedback or wordByWordFeedback).
         * @param {string} message The message to display.
         * @param {string} color The text color (e.g., 'lightgreen', 'red', '').
         * @param {boolean} isCompletion True if this is the completion message, false otherwise.
         */
        function displayFeedback(element, message, color = '', isCompletion = false) {
            clearTimeout(currentFeedbackTimeout); // Clear any existing timeout for previous messages

            element.textContent = message;
            element.style.color = color;
            element.style.opacity = 1; // Ensure it's visible when displayed

            if (isCompletion) {
                element.classList.add('completion-message');
            } else {
                element.classList.remove('completion-message');
            }

            // Set timeout for fading out regular feedback or completion message
            if (message !== '') { // Only set timeout if there's content to display
                currentFeedbackTimeout = setTimeout(() => {
                    element.style.opacity = 0; // Start fade-out
                    // After fade-out, clear content and reset styles
                    setTimeout(() => {
                        element.textContent = '';
                        element.style.color = '';
                        element.classList.remove('completion-message');
                    }, 500); // Allow transition to complete before clearing
                }, isCompletion ? 3000 : 800); // 3 seconds for completion, 0.8 seconds for others
            }
        }


        // --- Confetti Functions ---
        function resizeConfettiCanvas() {
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
        }

        function createConfettiParticle(x, y) {
            return {
                x: x,
                y: y,
                size: Math.random() * 8 + 4, // Particle size
                speedX: Math.random() * 10 - 5, // Horizontal speed
                speedY: Math.random() * -15 - 5, // Upward speed
                gravity: 0.5,
                color: 'white', // Changed to white confetti
                rotation: Math.random() * 360,
                rotationSpeed: Math.random() * 10 - 5
            };
        }

        function updateConfettiParticles() {
            confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);

            for (let i = confettiParticles.length - 1; i >= 0; i--) {
                const p = confettiParticles[i];

                p.speedY += p.gravity;
                p.x += p.speedX;
                p.y += p.speedY;
                p.rotation += p.rotationSpeed;

                // Draw particle
                confettiCtx.save();
                confettiCtx.translate(p.x, p.y);
                confettiCtx.rotate(p.rotation * Math.PI / 180);
                confettiCtx.fillStyle = p.color;
                confettiCtx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
                confettiCtx.restore();

                // Remove if off screen
                if (p.y > confettiCanvas.height) {
                    confettiParticles.splice(i, 1);
                }
            }

            if (confettiParticles.length > 0) {
                animationFrameId = requestAnimationFrame(updateConfettiParticles);
            } else {
                confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height); // Clear final time
                animationFrameId = null;
            }
        }

        function launchConfetti() {
            confettiParticles = []; // Clear existing particles
            const centerX = confettiCanvas.width / 2;
            const centerY = confettiCanvas.height / 2;

            for (let i = 0; i < 100; i++) { // 100 particles
                confettiParticles.push(createConfettiParticle(centerX, centerY));
            }

            if (!animationFrameId) { // Start animation only if not already running
                updateConfettiParticles();
            }
        }

        function clearConfetti() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            confettiParticles = [];
            confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        }

        /**
         * Toggles the visibility of the mode options container.
         */
        window.toggleModeOptions = function() { 
            modeOptionsContainer.classList.toggle('open');
        }

        /**
         * Handles keyboard input for the 'type-first-letters' mode.
         */
        function handleTypingKeydown(event) {
            // Only respond to single letter keys, not special keys like Shift, Ctrl, etc.
            if (event.key.length !== 1 || !event.key.match(/[a-z]/i)) {
                return; 
            }
            // Prevent default action (e.g., typing into some hidden input or scrolling)
            event.preventDefault(); 

            const typedChar = event.key.toLowerCase();
            
            if (typingWordIndex >= typingVerseWords.length) {
                // Already completed, do nothing
                return;
            }

            const targetWord = typingVerseWords[typingWordIndex];
            if (!targetWord) {
                displayFeedback(typingFeedback, "Error: Word not found.", 'red');
                return;
            }

            // Remove punctuation from the target word for comparison to get its first letter
            const targetWordClean = targetWord.replace(/[.,!?;:]+$/, '');
            const firstLetterOfTarget = targetWordClean.charAt(0).toLowerCase();

            if (typedChar === firstLetterOfTarget) {
                typingWordIndex++;
                displayFeedback(typingFeedback, getRandomMessage(correctMessages), 'lightgreen');
                renderCurrentModeDisplay(); // Re-render to show progress
            } else {
                displayFeedback(typingFeedback, getRandomMessage(incorrectMessages), 'red');
            }
        }

        /**
         * Renders the verse content based on the current display mode.
         * This function centralizes the rendering logic for all modes.
         */
        function renderCurrentModeDisplay() {
            const verse = currentActiveVerse; // Use the globally active verse object
            if (!verse) { // Handle case where no verse is selected/loaded
                verseReferenceElement.textContent = "Select a Passage";
                verseContentElement.textContent = "Please choose from the options above.";
                verseReferenceElement.href = "#";
                // Ensure all feedback areas are hidden/reset
                typingFeedback.classList.add('hidden');
                wordByWordFeedback.classList.add('hidden');
                displayFeedback(typingFeedback, ''); // Clear any lingering messages
                displayFeedback(wordByWordFeedback, '');
                return;
            }

            let displayedContentHtml = ''; 
            const words = verse.content.split(/\s+/).filter(word => word.length > 0);

            // Hide all mode-specific controls and clear feedback by default
            wordByWordControls.classList.add('hidden');
            typingContainer.classList.add('hidden');
            document.removeEventListener('keydown', handleTypingKeydown); 
            
            clearConfetti(); // Always clear confetti when changing modes or verses
            displayFeedback(typingFeedback, ''); // Clear any lingering messages
            displayFeedback(wordByWordFeedback, '');
            hiddenTypingInput.blur(); // Ensure keyboard is hidden
            
            if (currentDisplayMode === 'full-passage') {
                displayedContentHtml = verse.content;
            } else if (currentDisplayMode === 'first-letters') {
                const firstLetterParts = words.map((word) => {
                    const wordWithoutPunctuation = word.replace(/[.,!?;:]+$/, '');
                    const punctuation = word.match(/[.,!?;:]+$/) ? word.match(/[.,!?;:]+$/)[0] : ''; 
                    return (wordWithoutPunctuation.length > 0 ? wordWithoutPunctuation.charAt(0) : '') + punctuation;
                });
                displayedContentHtml = firstLetterParts.join(' ');
            } else if (currentDisplayMode === 'word-by-word') {
                wordByWordControls.classList.remove('hidden');
                wordByWordFeedback.classList.remove('hidden'); // Make feedback visible for this mode

                const revealedWords = words.slice(0, currentWordIndexForProgressiveReveal);
                const remainingWords = words.slice(currentWordIndexForProgressiveReveal).map(word => '_'.repeat(word.replace(/[.,!?;:]+$/, '').length) + (word.match(/[.,!?;:]+$/) ? word.match(/[.,!?;:]+$/)[0] : ''));
                displayedContentHtml = [...revealedWords, ...remainingWords].join(' ');
                

                // Check for completion in word-by-word mode
                if (currentWordIndexForProgressiveReveal >= words.length) {
                    nextWordBtn.textContent = "Done";
                    displayFeedback(wordByWordFeedback, getRandomMessage(completionMessages), '', true);
                    launchConfetti();
                    nextWordBtn.disabled = true; // Disable done button after completion
                } else {
                    nextWordBtn.textContent = "Next";
                    nextWordBtn.disabled = false;
                    displayFeedback(wordByWordFeedback, ''); // Clear for ongoing exercise
                }
                prevWordBtn.disabled = (currentWordIndexForProgressiveReveal === 0);

            } else if (currentDisplayMode === 'type-first-letters') {
                typingContainer.classList.remove('hidden');
                document.addEventListener('keydown', handleTypingKeydown); 
                // dynamicVerseDisplayContainer.classList.add('verse-scrollable'); // No longer needed here as it's always on the div

                let typedDisplayParts = [];
                for (let i = 0; i < words.length; i++) {
                    const word = words[i];
                    const wordWithoutPunctuation = word.replace(/[.,!?;:]+$/, '');
                    const punctuation = word.match(/[.,!?;:]+$/) ? word.match(/[.,!?;:]+$/)[0] : '';

                    if (i < typingWordIndex) {
                        // Revealed words get a special class for styling
                        typedDisplayParts.push(`<span class="revealed-word" id="typed-word-${i}">${word}</span>`); 
                    } else {
                        // Unrevealed words are underscores
                        if (wordWithoutPunctuation.length > 0) {
                            typedDisplayParts.push(`<span id="typed-word-${i}">${'_'.repeat(wordWithoutPunctuation.length)}${punctuation}</span>`);
                        } else {
                            typedDisplayParts.push(`<span id="typed-word-${i}">${punctuation}</span>`);
                        }
                    }
                }
                displayedContentHtml = typedDisplayParts.join(' ');
                
                // Focus the hidden input to bring up the keyboard
                hiddenTypingInput.focus();

                if (typingWordIndex < words.length) {
                    // Scroll to the current word being typed
                    const currentWordSpan = document.getElementById(`typed-word-${typingWordIndex}`);
                    if (currentWordSpan) {
                        currentWordSpan.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                } else {
                    // Verse completed
                    displayFeedback(typingFeedback, getRandomMessage(completionMessages), '', true);
                    launchConfetti(); 
                    document.removeEventListener('keydown', handleTypingKeydown); 
                    // Do not blur hidden input immediately to keep keyboard open (user might want to dismiss it manually)
                }
            }
            verseContentElement.innerHTML = displayedContentHtml; 
        }


        /**
         * Selects a display mode option and updates the UI.
         * @param {string} mode The selected display mode ('full-passage', 'first-letters', 'word-by-word', 'type-first-letters').
         */
        window.selectModeOption = function(mode) { 
            currentDisplayMode = mode; 

            // Update the text of the main mode selector button
            currentModeText.textContent = mode.replace(/-/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');

            // Update active state of individual options
            modeOptions.forEach(option => {
                if (option.dataset.mode === mode) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });

            // Ensure we have an active verse before proceeding
            const verse = currentActiveVerse;
            if (!verse) return; 

            // Reset mode-specific variables and feedback when switching modes
            currentWordIndexForProgressiveReveal = 0; 
            typingWordIndex = 0; 
            
            displayFeedback(typingFeedback, ''); 
            displayFeedback(wordByWordFeedback, '');

            clearConfetti(); // Always clear confetti when switching modes
            hiddenTypingInput.blur(); // Ensure keyboard is hidden when switching modes

            if (mode === 'word-by-word') {
                currentWordsArray = verse.content.split(/\s+/).filter(word => word.length > 0);
            } else if (mode === 'type-first-letters') {
                typingVerseWords = verse.content.split(/\s+/).filter(word => word.length > 0);
            }

            renderCurrentModeDisplay(); 
            toggleModeOptions(); 
        }

        /**
         * Reveals the next word/part in the 'word-by-word' display mode.
         */
        window.showNextWord = function() { 
            // Ensure currentWordsArray is populated before trying to access its length
            if (!currentActiveVerse) return; 

            currentWordsArray = currentActiveVerse.content.split(/\s+/).filter(word => word.length > 0);

            if (currentWordIndexForProgressiveReveal < currentWordsArray.length) {
                currentWordIndexForProgressiveReveal++; 
                renderCurrentModeDisplay(); 
            }
        }

        /**
         * Hides the last revealed word/part in the 'word-by-word' display mode.
         */
        window.showPreviousWord = function() { 
            if (currentWordIndexForProgressiveReveal > 0) {
                currentWordIndexForProgressiveReveal--;
                renderCurrentModeDisplay();
            }
        }

        /**
         * Displays a specific verse and updates the YouVersion link.
         * @param {object} verseObject The full verse object to display.
         */
        window.displaySpecificVerse = function(verseObject) { 
            // Set the global active verse object
            currentActiveVerse = verseObject;

            if (!currentActiveVerse) {
                // If for some reason currentActiveVerse is null after assignment (e.g., passed null initially)
                verseReferenceElement.textContent = "Select a Passage";
                verseContentElement.textContent = "Please choose from the options above.";
                verseReferenceElement.href = "#";
                customTextFeedback.textContent = '';
                customTextFeedback.style.color = '';
                // Ensure all feedback areas are hidden/reset
                typingFeedback.classList.add('hidden');
                wordByWordFeedback.classList.add('hidden');
                displayFeedback(typingFeedback, ''); 
                displayFeedback(wordByWordFeedback, '');
                return;
            }

            verseReferenceElement.textContent = currentActiveVerse.reference; 
            verseReferenceElement.href = currentActiveVerse.youversionUrl || "#"; 
            
            // Always start with 'full-passage' when a new verse is selected or loaded
            selectModeOption('full-passage');

            // Set the typingVerseWords and currentWordsArray based on the new verse content,
            // as they are used by the mode rendering functions.
            typingVerseWords = currentActiveVerse.content.split(/\s+/).filter(word => word.length > 0);
            currentWordsArray = typingVerseWords; // Also update for word-by-word
        }

        /**
         * Loads custom text from the textarea and displays it.
         */
        window.loadCustomText = function() { 
            const customText = customTextInput.value.trim();
            if (customText.length > 0) {
                const customVerseObject = {
                    reference: "Your Custom Text",
                    content: customText,
                    youversionUrl: "#" // No YouVersion link for custom text
                };
                displaySpecificVerse(customVerseObject);
                customTextFeedback.textContent = "Custom text loaded!";
                customTextFeedback.style.color = 'lightgreen';
            } else {
                customTextFeedback.textContent = "Please enter some text to load.";
                customTextFeedback.style.color = 'red';
            }
            // Blur the text area to dismiss keyboard on mobile after loading
            customTextInput.blur();
        }

        /**
         * Toggles the visibility of the side menu and overlay.
         */
        window.toggleMenu = function() {
            sideMenu.classList.toggle('open');
            if (sideMenu.classList.contains('open')) {
                menuOverlay.style.display = 'block';
            } else {
                menuOverlay.style.display = 'none';
            }
        }

        /**
         * Shares the app link via the Web Share API.
         */
        window.shareApp = function() {
            toggleMenu(); // Close the menu
            if (navigator.share) {
                navigator.share({
                    title: 'Check out this Scripture Meditation App!',
                    text: 'I\'ve been using this app to meditate on scripture. You should check it out!',
                    url: window.location.href // Current app URL
                }).then(() => {
                    console.log('Successfully shared');
                }).catch((error) => {
                    console.error('Error sharing:', error);
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                alert("To share this app, copy this link and paste it in a message: " + window.location.href);
            }
        }

        /**
         * Refreshes the application to check for updates.
         */
        window.checkForUpdates = function() {
            toggleMenu(); // Close the menu
            window.location.reload(true); // Force a hard reload from the server
        }

        /**
         * Initializes the version number display and increments it.
         */
        function initializeVersionNumber() {
            let version = localStorage.getItem('appVersion');
            if (version === null) {
                version = 1.0; // Start at 1.0 if not set
            } else {
                version = parseFloat(version) + 0.1; // Increment by 0.1
                version = parseFloat(version.toFixed(1)); // Keep one decimal place
            }
            localStorage.setItem('appVersion', version);
            versionNumberDisplay.textContent = `Created by NewJourneyDesigns v${version.toFixed(1)}`;
        }

        // Default to Romans 8:37-39 (index 4) and display it in 'full-passage' mode when the window loads
        // Ensure that verses[4] actually exists before trying to access it.
        window.onload = function() {
            if (verses[4]) { // Check if the default verse exists
                displaySpecificVerse(verses[4]); 
            } else {
                // Fallback if the default verse is somehow missing
                displaySpecificVerse(null); 
            }
            resizeConfettiCanvas(); // Initialize confetti canvas size
            initializeVersionNumber(); // Initialize and display the version number
            
            // Set the current year in the footer
            const footerYearEl = document.getElementById('footer-year');
            if (footerYearEl) {
                footerYearEl.textContent = new Date().getFullYear();
            }
        };

        window.addEventListener('resize', resizeConfettiCanvas); // Resize confetti canvas on window resize

        // Event Listener for the new custom text button
        loadCustomTextBtn.addEventListener('click', loadCustomText);
</script>
    <div class="menu-footer" style="display: flex; flex-direction: column; align-items: center;">
        <a href="https://newjourneydesigns.co" target="_blank" rel="noopener noreferrer">
            <img src="https://i.imgur.com/mIDddQA.png" alt="New Journey Designs Logo" style="width: 60px; height: auto; margin-bottom: 0.5rem;">
        </a>
        <div>
            Created for the betterment of your mind &amp; soul by 
            <a href="https://newjourneydesigns.co" target="_blank" rel="noopener noreferrer"><strong>NewJourneyDesigns.Co</strong></a>
        </div>
        <div>&copy; <span id="footer-year">2025</span></div>
    </div>
</body>
</html>
